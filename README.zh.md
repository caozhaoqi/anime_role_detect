# 角色分类系统使用说明

## 🎯 系统简介

角色分类系统是一个基于人工智能的图片识别工具，专门用于识别游戏和动漫中的角色。系统使用先进的深度学习技术，能够快速准确地识别上传图片中的角色。

## ✨ 核心功能

- **图片上传识别**：支持多种图片格式上传，自动识别图片中的游戏角色
- **高准确率**：使用CLIP模型和Faiss索引，识别准确率高
- **实时反馈**：提供识别置信度和详细结果
- **用户友好界面**：直观的Web界面，操作简单
- **API支持**：提供RESTful API接口，支持批量处理
- **日志融合**：支持从分类日志中融合特征，构建新模型

## 🚀 快速开始

### 环境要求

- Python 3.7+
- Flask
- PyTorch
- Transformers
- Ultralytics (YOLOv8)
- Faiss

### 安装依赖

```bash
# 安装Flask
pip3 install flask

# 安装其他依赖（如果尚未安装）
pip3 install torch torchvision transformers ultralytics faiss-cpu Pillow
```

### 启动系统

#### 1. 启动后端服务

```bash
# 启动Flask后端应用
python3 src/web/web_app.py
```

后端服务将在 `http://127.0.0.1:5001` 上运行。

#### 2. 启动前端服务

```bash
# 进入前端目录
cd frontend

# 安装依赖（首次运行）
npm install

# 启动Next.js前端应用
npm run dev
```

前端服务将在 `http://localhost:3000` 上运行。

## 📁 项目结构

```
anime_role_detect/
├── data/                   # 数据目录
│   ├── blue_archive_optimized/      # 优化后的蔚蓝档案数据
│   └── blue_archive_optimized_v2/   # 增强版蔚蓝档案数据
├── src/                    # 源代码
│   ├── core/               # 核心模块
│   │   ├── classification/         # 分类模块
│   │   ├── feature_extraction/     # 特征提取模块
│   │   ├── preprocessing/          # 预处理模块
│   │   ├── general_classification.py  # 通用分类模块
│   │   └── log_fusion/              # 日志融合模块
│   └── web/                # 网页应用
│       ├── templates/      # HTML模板
│       ├── static/         # 静态文件
│       └── web_app.py      # Flask应用
├── scripts/                # 辅助脚本
├── tests/                  # 测试代码
├── README.md               # 英文文档
└── README.zh.md            # 中文文档
```

## 🎮 支持的角色

### 蔚蓝档案 (Blue Archive)

- **星野** (Hoshino)
- **白子** (Shiroko)
- **阿罗娜** (Arona)
- **宫子** (Miyako)
- **日奈** (Hina)
- **优花梨** (Yuuka)

## 🌐 使用方法

### Web界面使用

1. 打开浏览器，访问 `http://127.0.0.1:5001`
2. 点击「选择图片文件」按钮，选择要识别的图片
3. 点击「识别角色」按钮，系统将自动分析图片
4. 等待分析完成，查看识别结果和置信度

### API调用

```bash
# 使用curl上传图片并识别
curl -X POST -F "file=@path/to/image.jpg" http://127.0.0.1:5001/api/classify
```

API返回结果示例：

```json
{
  "filename": "image.jpg",
  "role": "蔚蓝档案_星野",
  "similarity": 0.98,
  "boxes": []
}
```

## 📊 系统性能

### 识别准确率

| 角色 | 准确率 |
|------|--------|
| 优花梨 | 100% |
| 阿罗娜 | 83.33% |
| 宫子 | 60% |
| 星野 | 40% |
| 白子 | 37.50% |
| 日奈 | 30% |

### 平均处理时间

- 图片上传：~1秒
- 预处理：~0.5秒
- 特征提取：~0.3秒
- 分类：~0.1秒
- 总时间：~2秒

## 🔧 技术实现

### 核心技术栈

| 技术 | 用途 |
|------|------|
| Python | 主要开发语言 |
| Flask | Web应用框架 |
| PyTorch | 深度学习框架 |
| CLIP | 图像特征提取 |
| YOLOv8 | 角色检测 |
| Faiss | 相似性搜索 |
| HTML/CSS | 前端界面 |

### 工作流程

1. **图片上传**：用户上传图片到Web应用
2. **预处理**：使用YOLOv8检测图片中的角色，裁剪和标准化图像
3. **特征提取**：使用CLIP模型提取图像特征向量
4. **相似度搜索**：使用Faiss索引搜索最相似的角色特征
5. **结果展示**：显示识别结果和置信度
6. **日志融合**：收集分类日志，融合特征构建新模型

## 📈 系统优化

### 性能优化

- **单例模式**：避免重复初始化模型，减少内存使用
- **缓存机制**：缓存已处理的结果，提高响应速度
- **批量处理**：支持批量图像分类，提高处理效率
- **异步加载**：模型懒加载，加快系统启动速度

### 用户体验优化

- **加载动画**：添加上传和处理时的加载动画
- **响应式设计**：适配不同屏幕尺寸
- **实时反馈**：提供详细的识别结果和置信度
- **错误处理**：友好的错误提示

## 🔄 日志融合功能

### 功能介绍

日志融合功能是系统的一个重要特性，它能够：

- **收集分类日志**：自动收集每次分类的结果和特征
- **融合特征**：将多个分类结果的特征融合成一个新的模型
- **持续学习**：从历史分类数据中学习，不断提高分类准确率
- **模型更新**：定期更新模型，保持系统性能

### 使用方法

#### 1. 收集分类日志

系统会自动收集每次分类的结果，包括：
- 上传的图片
- 提取的特征向量
- 分类结果
- 置信度

#### 2. 融合特征构建新模型

```bash
# 运行日志融合脚本
python3 src/core/log_fusion/log_fusion.py --log_dir ./logs --output_model ./models/fused_model
```

#### 3. 使用新模型进行分类

系统会自动使用最新构建的模型进行分类，无需额外配置。

## 🤝 贡献指南

欢迎提交Issue和Pull Request，共同改进系统性能和功能。

## 📄 许可证

本项目基于MIT许可证开源。

## 📞 联系我们

如有问题或建议，请通过以下方式联系：

- Email: zhaoqi.cao@icloud.com
- GitHub: https://github.com/caozhaoqi/anime-role-detect

---

**© 2026 角色分类系统** - 让角色识别变得简单！