# 项目结构说明

## 1. 项目概览

本项目是一个动漫角色检测系统，用于识别和分类不同动漫和游戏中的角色。项目采用深度学习技术，通过数据采集、处理、模型训练和部署的完整流程，实现角色的自动识别。

## 2. 目录结构

```
anime_role_detect/
├── data/                  # 数据集目录
│   ├── augmented_dataset/ # 增强后的数据集
│   ├── split_dataset/     # 分割后的训练/验证数据
│   └── all_characters/    # 所有角色图片
├── models/                # 模型存储目录
├── src/                   # 源代码
│   ├── backend/           # 后端代码
│   │   ├── api/           # API实现
│   │   └── web/           # Web界面
│   ├── core/              # 核心功能
│   │   ├── classification/ # 分类模块
│   │   ├── feature_extraction/ # 特征提取模块
│   │   ├── preprocessing/ # 预处理模块
│   │   └── logging/       # 日志模块
│   ├── data/              # 数据相关代码
│   │   ├── collection/    # 数据收集脚本
│   │   ├── preprocessing/ # 数据预处理脚本
│   │   └── augmentation/  # 数据增强脚本
│   ├── frontend/          # 前端代码
│   ├── models/            # 模型相关代码
│   │   ├── training/      # 模型训练脚本
│   │   ├── evaluation/    # 模型评估脚本
│   │   └── deployment/    # 模型部署脚本
│   ├── config/            # 配置文件
│   ├── scripts/           # 实用脚本
│   └── utils/             # 工具函数
├── cache/                 # 缓存目录
├── auto_spider_img/       # 自动爬虫图片
├── docs/                  # 文档目录
│   ├── PROJECT_STRUCTURE.md  # 项目结构说明
│   └── ...                # 其他文档
├── tests/                 # 测试目录
├── README.md              # 英文文档
└── README.zh.md            # 中文文档
```

## 3. 模块说明

### 3.1 配置模块 (src/config/)

- **config.py**: 主配置文件，集中管理项目的所有配置参数，包括路径、阈值、训练参数等。

### 3.2 数据模块 (data/)

- **augmented_dataset/**: 增强后的数据集，用于模型训练。
- **split_dataset/**: 分割后的训练/验证/测试数据。
- **all_characters/**: 所有角色图片，按角色分类存储。

### 3.3 文档模块 (docs/)

- **PROJECT_STRUCTURE.md**: 项目结构说明文档。
- 其他文档文件，如API文档、使用说明等。

### 3.4 模型模块 (models/)

- 存储训练好的模型文件。

### 3.5 源代码模块 (src/)

#### 3.5.1 后端模块 (backend/)

- **api/**: API实现，提供RESTful接口。
- **web/**: Web界面，包括Flask应用和HTML模板。

#### 3.5.2 核心功能模块 (core/)

- **classification/**: 分类模块，包括DeepDanbooru和EfficientNet推理。
- **feature_extraction/**: 特征提取模块，用于提取图像特征。
- **preprocessing/**: 预处理模块，用于图像预处理。
- **logging/**: 日志模块，提供全局日志功能。

#### 3.5.3 数据相关模块 (data/)

- **collection/**: 数据收集脚本，包括基于系列和关键词的采集器。
- **preprocessing/**: 数据预处理脚本，包括数据质量控制和数据集分割。
- **augmentation/**: 数据增强脚本，用于扩充训练数据集。

#### 3.5.4 前端模块 (frontend/)

- 前端代码，包括HTML、CSS和JavaScript文件。

#### 3.5.5 模型相关模块 (models/)

- **training/**: 模型训练脚本，包括基础训练、改进训练和超参数调优。
- **evaluation/**: 模型评估脚本，用于评估模型性能。
- **deployment/**: 模型部署脚本，用于模型部署和推理。

#### 3.5.6 脚本模块 (scripts/)

各种实用脚本，用于辅助任务。

#### 3.5.7 工具模块 (utils/)

- **config_utils.py**: 配置工具，方便其他模块使用配置。
- 其他工具函数和类。

### 3.6 缓存模块 (cache/)

- 缓存目录，用于存储临时数据和缓存结果。

### 3.7 测试模块 (tests/)

单元测试和集成测试文件。

### 3.8 自动爬虫模块 (auto_spider_img/)

- **characters/**: 角色列表目录，存储各个系列的角色名称。
- **anime_set.txt**: 系列配置文件，定义需要采集的动漫和游戏系列。
- 其他爬虫相关文件。

## 4. 核心功能

### 4.1 数据采集

- 基于系列的角色图像采集
- 基于关键词的图像搜索
- 从多个来源获取角色信息
- 图像质量控制和过滤

### 4.2 数据处理

- 数据质量评估
- 数据增强
- 数据集分割
- 数据格式转换

### 4.3 模型训练

- 基础模型训练
- 模型优化和调优
- 模型集成
- 模型格式转换

### 4.4 模型推理

- 角色识别
- 置信度评估
- 结果输出

## 5. 使用流程

1. **配置项目**: 修改config.py中的配置参数。
2. **数据采集**: 运行数据采集脚本，获取角色图像。
3. **数据处理**: 运行数据处理脚本，准备训练数据。
4. **模型训练**: 运行模型训练脚本，训练角色识别模型。
5. **模型评估**: 运行模型评估脚本，评估模型性能。
6. **模型部署**: 转换模型为ONNX格式，部署到生产环境。

## 6. 技术栈

- **编程语言**: Python 3.9+
- **深度学习框架**: PyTorch
- **图像处理**: OpenCV, PIL
- **数据存储**: 本地文件系统
- **模型格式**: PyTorch, ONNX

## 7. 扩展说明

### 7.1 添加新角色

1. 在auto_spider_img/characters/目录下创建新的角色列表文件。
2. 在anime_set.txt中添加新的系列。
3. 运行数据采集脚本获取新角色的图像。

### 7.2 扩展模型

1. 在src/model_training/目录下创建新的模型训练脚本。
2. 修改配置文件中的模型参数。
3. 运行新的模型训练脚本。

### 7.3 部署到新环境

1. 转换模型为ONNX格式。
2. 根据目标环境的要求，调整部署代码。
3. 部署模型到目标环境。

## 8. 维护说明

- **数据更新**: 定期更新角色列表和图像数据。
- **模型更新**: 定期重新训练模型，以适应新数据。
- **配置管理**: 集中管理配置参数，避免硬编码。
- **代码规范**: 遵循Python代码规范，保持代码可读性。

## 9. 总结

本项目采用模块化设计，结构清晰，功能完整。通过合理的目录组织和模块划分，提高了代码的可维护性和可扩展性。同时，通过集中的配置管理，使得项目参数的调整更加方便。

项目的核心价值在于实现了从数据采集到模型部署的完整流程，为动漫角色的自动识别提供了可行的解决方案。